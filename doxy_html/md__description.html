<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>ArnLib: General Description</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">ArnLib
   &#160;<span id="projectnumber">1.0.x</span>
   </div>
   <div id="projectbrief">Active Registry Network</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('md__description.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Properties</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">General Description </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#gen_arnobj">Arn Data Objects    </a><ul><li class="level2"><a href="#gen_arnobjModes">Modes</a></li>
<li class="level2"><a href="#gen_naming">Naming conventions</a></li>
</ul>
</li>
<li class="level1"><a href="#gen_bidirArnobj">Bidirectional Arn Data Objects    </a><ul><li class="level2"><a href="#gen_pipeArnobj">Pipes</a></li>
</ul>
</li>
<li class="level1"><a href="#gen_persistArnobj">Persistent Arn Data Objects    </a><ul><li class="level2"><a href="#gen_fileArnobj">Saving objects in files</a></li>
</ul>
</li>
<li class="level1"><a href="#gen_shareArnobj">Sharing Arn Data Objects    </a></li>
<li class="level1"><a href="#gen_rpc">RPC and SAPI    </a><ul><li class="level2"><a href="#gen_rpcformat">RPC and SAPI communication format</a></li>
</ul>
</li>
<li class="level1"><a href="#gen_appnote">Application notations    </a></li>
</ul>
</div>
<div class="textblock"><p>This document describes the general concepts of the ArnLib. <br/>
<br/>
</p>
<h1><a class="anchor" id="gen_arnobj"></a>
Arn Data Objects    </h1>
<p>All objects are stored in a tree hierarchy and the naming is similar to typical file systems, e.g. "//Measure/Water/Temperature/value".</p>
<p>To get a handle to a folder, use a path ending with "/", e.g "//Measure/Water/".</p>
<p>Folder names can be empty. In the above example, the first level folder is empty and the second level folder is "Measure". The empty folder name can also be referred as "@". Again, the example can equally be written "/@/Measure/Water/Temperature/value". This "@" is typically used when an empty name is unacceptable, e.g. in the tree viewer of ArnBrowser.</p>
<p>Each part in a given path is dynamically added as needed, i.e. any path can be used without explicitly creating each folder in advance. <br/>
<br/>
</p>
<h2><a class="anchor" id="gen_arnobjModes"></a>
Modes</h2>
<p><em>Mode</em> change is a one direction process. Once a specific <em>mode</em> is set, it can't be reset.</p>
<p>If the <a class="el" href="class_arn_item.html" title="Handle for an Arn Data Object.">ArnItem</a> is in a closed state when the <em>mode</em> change is done, the added modes will be stored and the real <em>mode</em> change is done when the <a class="el" href="class_arn_item.html" title="Handle for an Arn Data Object.">ArnItem</a> is opened to an <em>Arn Data Object</em>. This implies that ArnItems can benefit from <em>mode</em> settings before being opened.</p>
<p>If the <em>general mode</em> change is done to a <a href="#gen_shareArnobj">shared</a> object, the change of <em>general mode</em> is also done at the server and any connected clients.</p>
<p>The following <em>general modes</em> are available:</p>
<ul>
<li><b>BiDir</b> A two-way object, typically for validation or pipe. See <a href="#gen_bidirArnobj">bidirectional</a> objects.</li>
<li><b>Pipe</b> Implies <em>BiDir</em> and all data is preserved as a stream during <a href="#gen_shareArnobj">sharing</a>. Without <em>Pipe mode</em>, <a href="#gen_shareArnobj">sharing</a> is optimized to sync latest value and not all values in a stream.</li>
<li><b>Save</b> Sets the <em>Arn Data Object</em> as persistent and any data assigned to it will be saved. The persistent service must be started at the server. See <a href="#gen_persistArnobj">persistent</a> objects.</li>
</ul>
<p>Additionally there are some <em>sync modes</em>. These modes are used by the local client session and are not shared with others. The <em>sync modes</em> must be set before the <a class="el" href="class_arn_item.html" title="Handle for an Arn Data Object.">ArnItem</a> is opened to an <em>Arn Data Object</em>.</p>
<p>Following <em>sync_modes</em> are available:</p>
<ul>
<li><b>Master</b> The <em>Arn Data Object</em> (at client side) is set as <em>default generator</em> of data. Normally the server is the <em>default generator</em> of data. This makes difference when client connects or reconnects to the server. The data from the <em>default generator</em> is then used and synced.</li>
<li><b>AutoDestroy</b> The <em>Arn Data Object</em> (at client side) is set up for auto destruction. When the client closes tcp/ip, the server side will destroy the <em>Arn Data Object</em> and this will also be done at any connected clients.</li>
</ul>
<p>Note: It's convenient to always set all the needed modes before an <a class="el" href="class_arn_item.html" title="Handle for an Arn Data Object.">ArnItem</a> is opened or an <a class="el" href="class_arn_item.html" title="Handle for an Arn Data Object.">ArnItem</a> is used as a template. See <a class="el" href="class_arn_item.html#ad0abf36e61104c113f46503bfcf4f39a" title="Mark this ArnItem as a template.">ArnItem::setTemplate()</a>. <br/>
<br/>
</p>
<h2><a class="anchor" id="gen_naming"></a>
Naming conventions</h2>
<p>These rules must not be obeyed, but are recommended, to get the most benefits of the Arn echo system, like ArnBrowser.</p>
<ul>
<li>First level folder not empty, e.g "/MyLocalFolder/Key/value", is a local path and is not <a href="#gen_shareArnobj">shared</a>.</li>
<li>First level folder empty, e.g. "//MyGlobalFolder/Date/value", is a global path and is <a href="#gen_shareArnobj">shared</a> to server and clients.</li>
<li>When a leaf is used as an attribute, the following names are reserved:<ul>
<li><b>value</b> the value of the above closest folder denotation, e.g. "Temperature".</li>
<li><b>set</b> allowed values and conversion to a more descriptive form, e.g. "0=Off 1=On".</li>
<li><b>property</b> like precision and unit, e.g. "prec=1 unit=°C".</li>
<li><b>info</b> like tool tips, e.g. "&lt;tt\&gt;Standard UV radiation index&lt;/tt\&gt;".</li>
<li><b>help.</b>XXX like "help.html" contains help in xhtml format. <br/>
<br/>
</li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="gen_bidirArnobj"></a>
Bidirectional Arn Data Objects    </h1>
<p>A bidirectional <em>Arn Data Object</em> is actually a double object, a twin. Each part has its own path but their life span is depending on each other.</p>
<p>One part is the normal "official" and the other part is <em>provider</em>. The provider has an added "!" to the normal path, e.g. normal = "//Measure/Depth/value", provider = "//Measure/Depth/value!".</p>
<p>Data written to one part ends up in the other. When a provider slot is connected to the provider part (<a class="el" href="class_arn_item.html" title="Handle for an Arn Data Object.">ArnItem</a>), the slot will receive "request" data from the normal part. The provider slot processes the request data and writes the result to the same provider part. This way the result will end up in the normal "official" part.</p>
<p>This functionality can typically be used for data validation and limiting. <br/>
<br/>
</p>
<h2><a class="anchor" id="gen_pipeArnobj"></a>
Pipes</h2>
<p><em>Pipes</em> also use the <a href="#gen_bidirArnobj">bidirectional</a> functionality. The two (twin) parts are then named <em>requester</em> and <em>provider</em>.</p>
<p>All data put into a pipe are part of a stream and as such will be fully transfered (syncronized) if they are <a href="#gen_shareArnobj">shared</a> with a server and other clients. <br/>
<br/>
</p>
<h1><a class="anchor" id="gen_persistArnobj"></a>
Persistent Arn Data Objects    </h1>
<p>The <em>server</em> must use <a class="el" href="class_arn_persist.html">ArnPersist</a> to support the persistance service. As a standard, objects are stored in a SQLite database. It's also possible to store each object as a file.</p>
<p>Any connected <em>client</em> or the <em>server</em> can make an <em>Arn Data Object</em> persistent. It's just to open an <a class="el" href="class_arn_item.html" title="Handle for an Arn Data Object.">ArnItem</a> to the object and change <em>mode</em> to <em>Save</em>. </p>
<blockquote class="doxtable">
<p><a class="el" href="class_arn_item.html" title="Handle for an Arn Data Object.">ArnItem</a> arnMaxLevel; <br/>
 arnMaxLevel.addMode( ArnItem::Mode::Save); <br/>
 arnmaxLevel.open("//config/Level/Max/value"); <br/>
</p>
<p></p>
</blockquote>
<p>When the <em>Arn Data Object</em> is set to <em>Save</em> mode, it's automatically loaded by the <a class="el" href="class_arn_persist.html">ArnPersist</a>. At the <em>server</em> this is instantly done. A <em>client</em> has to wait for the value to get synced from the <em>server</em>. It's convenient to use <a class="el" href="class_arn_depend.html" title="Class for setting up dependencis to needed services.">ArnDepend</a> to get a signal when the value is loaded and ready to use.</p>
<p>When the <em>Arn Data Object</em> is changed, it will be automatically saved by <a class="el" href="class_arn_persist.html">ArnPersist</a>. There is a delay from first change of the object until the saving is done, see <a class="el" href="class_arn_item.html#a2487337c3924ea323ec6462b8b0aee08" title="Set delay of data changed signal.">ArnItem::setDelay()</a>. This allows for intensive updates of the object without choking down the server with saving operations.</p>
<p>It's possible to mark an object in the SQLite data base as <em>mandatory</em>. In this way the <em>Arn Data Object</em> is set as <em>persistent</em> and gets loaded at start of <a class="el" href="class_arn_persist.html">ArnPersist</a>. <br/>
<br/>
</p>
<h2><a class="anchor" id="gen_fileArnobj"></a>
Saving objects in files</h2>
<p>To use the <em>persistent</em> storing of <em>Arn Data Objects</em> in files, the <em>root</em> directory is set by: <a class="el" href="class_arn_persist.html#a34de416764dae40d9d3b6ab962ed2a8a" title="Set the VCS persistent file directory root">ArnPersist::setPersistDir()</a>. This can also be combined with support of VCS (version control system).See <a class="el" href="class_arn_persist.html#a91359d742060af64cd3853806cdb9b8e" title="Set the Version Control System to be used.">ArnPersist::setVcs()</a>. Currently there is a support module for <em>git</em>.</p>
<p>In the <em>root</em> directory and below, all (VCS) persistent files are stored. The <em>root</em> directory corresponds to the <em>root</em> in Arn tree.</p>
<blockquote class="doxtable">
<p>Example: <em>root</em> directory is set to "/usr/local/arn_persist". There &gt; is a file stored</p>
<p></p>
</blockquote>
<p>at "/usr/local/arn_persist/@/doc/help.html". This &gt; file will be mapped to Arn at "//doc/help.html".</p>
<p>Any files stored in the <em>root</em> directory and below, get loaded into their <em>Arn Data Object</em> with <em>mode</em> set as <em>persistent</em> at start of <a class="el" href="class_arn_persist.html">ArnPersist</a>.</p>
<p>The files get updated in a similar way to the data base update. <br/>
<br/>
</p>
<h1><a class="anchor" id="gen_shareArnobj"></a>
Sharing Arn Data Objects    </h1>
<p>A fundamental aspect of <em>Arn</em> is that <em>Arn Data Objects</em> can be shared. This is centralized to the <em>Arn Server</em>, which stores all shared objects. It's still a distributed model as each client and server has their own set of <em>Arn Data Objects</em> that operate independent of any connection.</p>
<p>Each <em>Arn Client</em> connects to the <em>Arn Server</em> and decides which part of the <em>Arn Data Object</em> tree to be shared. <br/>
 <code><a class="el" href="class_arn_client.html#a7eb3feacb7aa1d4fe6b128962c7fc548" title="Set the sharing tree path.">ArnClient::setMountPoint</a>("/share/")</code> will make the tree"/share/" shared. <br/>
 This doesn't mean that everything in the shared tree at the server now will be available at the client. The client has to create an <em>Arn Data Object</em> in the shared tree. The client can then decide the exact objects of interest. <br/>
 <code>ArnItem::Open("/share/Test/value")</code> will open a shared object (in previous example).</p>
<p>Note: Normally "//" is used for global (shared). See <a href="#gen_naming">naming conventions</a>. <br/>
<br/>
</p>
<h1><a class="anchor" id="gen_rpc"></a>
RPC and SAPI    </h1>
<p><a class="el" href="class_arn_rpc.html" title="Remote Procedure Call.">ArnRpc</a> is the basic functionality of RPC (Remote Procedure Call). <a class="el" href="class_arn_sapi.html" title="Service API.">ArnSapi</a> implements SAPI (Service Application Programming Interface) and is using <a class="el" href="class_arn_rpc.html" title="Remote Procedure Call.">ArnRpc</a> as its base. It's recommended to use <a class="el" href="class_arn_sapi.html" title="Service API.">ArnSapi</a> which has a higher level model.</p>
<p>The SAPI works by a model which can be described as RPC by <em>remote signal slots</em>. The <em>provider</em> is usually assumed to wait for a <em>requester</em> to initiate the session and then react to different remote calls from the <em>requester</em>. However, this is full duplex, so any side can make a remote call at any time.</p>
<p>A good example of the usage of SAPI is the <em>Arn Demo Chat</em>, which is included in the source package of the <em>ArnLib</em>.</p>
<p><a class="el" href="class_arn_rpc.html" title="Remote Procedure Call.">ArnRpc</a> uses <a class="el" href="md__description.html#gen_pipeArnobj">pipes</a> to communicate. The <em>pipes</em> can be monitored and receive test stimuli from the <em>Arn Browser</em> program. The used <a href="#gen_rpcformat">protocol</a> is XString based and quite easy to handtype when common data types are used. "$help" will give the syntax for the actual custom SAPI.</p>
<p>A SAPI is setup by deriving the <a class="el" href="class_arn_sapi.html" title="Service API.">ArnSapi</a> class to a new class that defines the <em>custom SAPI</em>. This custom-declared class is included at both the <em>provider</em> and <em>requester</em> ends. The <em>custom SAPI</em> class by itself doesn't implement any <em>services</em>. It's merely a hub for connections to <em>external signals and slots</em>. The base <a class="el" href="class_arn_sapi.html" title="Service API.">ArnSapi</a> class automatically transfers all <em>custom signal</em> (SAPI) calls to the remote connected ends, which also have the <a class="el" href="class_arn_sapi.html" title="Service API.">ArnSapi</a> derived class and that emits the transfered signal.</p>
<p>The provider connects the signals from custom SAPI that are prefixed with "pv_" (as default) to each external slot that implements the services. In the same way the <em>requester</em> connects the signals prefixed with "rq_" to its external "service" slots.</p>
<p>When there is a naming pattern between the <em>SAPI services</em> and the <em>external signals and slots</em>, it's a great convenience to use ArnRpc::BatchConnect(). This saves a lot of QObject::connect() calls. Also newly added services in the SAPI, that obey the naming scheme, will automaically be connected to the newly matching <em>external signals and slots</em> for implementation of the <em>service</em>.</p>
<p>An extended feature comparing to normal <em>signals</em> is that the <em>SAPI signals</em> are <em>public</em> and can be called by non-derived classes. This makes it optional to use both <em>signal to signal</em> connections or direct <em>signal</em> calls when issuing a RPC to the remote side.</p>
<p>The <em>service</em> slot can get the emitting <em>custom SAPI</em> object by using normal QObject::sender() functionality. <br/>
<br/>
</p>
<h2><a class="anchor" id="gen_rpcformat"></a>
RPC and SAPI communication format</h2>
<p>The RPC calling has a basic format as XString (see <a class="el" href="class_x_string_map.html" title="Container class with string representation.">XStringMap</a>). The most generic form is seen below. The type mark <em>T</em> is "t" for writeable types and "tb" for binary (non writeable) types. </p>
<blockquote class="doxtable">
<p><em>funcname</em> <em>T</em>=_type1_ a._label1_=_arg1_ <em>T</em>=_type2_ a._label2_=_arg2_ ... <br/>
 Example: put t=QString a.id=level t=int a.value=123 <br/>
 For calling: put( QString("level"), 123)</p>
<p></p>
</blockquote>
<p>Commonly used <em>types</em> have a shorter form. The <em>types</em> are: </p>
<blockquote class="doxtable">
<p><em>int</em>, <em>uint</em>, <em>bool</em>, _ba (QByteArray), list (QStringList), and default is QString</p>
<p></p>
</blockquote>
<p>This can be used in previous example: </p>
<blockquote class="doxtable">
<p>put a.id=level int.value=123</p>
<p></p>
</blockquote>
<p>Or even shorter, skipping labels, when typed by hand: </p>
<blockquote class="doxtable">
<p>put level int=123</p>
<p></p>
</blockquote>
<p>List (QStringList) can be used. The <em>le</em> is <em>list element</em>. All examples below will get same resulting call. </p>
<blockquote class="doxtable">
<p>For a function: void test( QStringList lst, int num) <br/>
 test list=red green blu int=3 <br/>
 test list.lst=red green blu int.num=3 <br/>
 test list= le=red le=green le=blu int=3 <br/>
 test list=red le=green blu int=3 <br/>
</p>
<p></p>
</blockquote>
<p>For special cases, like empty elements, the <em>le</em> (list element) is needed. The example below has a first empty element followed by "green". </p>
<blockquote class="doxtable">
<p>test list= le= green blue int=2</p>
<p></p>
</blockquote>
<p>The built-in call "$help" will give an automatically generated list of the present SAPI with the syntax for each available service. <br/>
<br/>
</p>
<h1><a class="anchor" id="gen_appnote"></a>
Application notations    </h1>
<ul>
<li>If any graphics are used, Gui must be included.</li>
</ul>
<ul>
<li>If only using QImage, Windowing system can be off, like: QApplication a(argc, argv, false); </li>
</ul>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Tue Apr 9 2013 15:33:50 for ArnLib by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.1 </li>
  </ul>
</div>
</body>
</html>
